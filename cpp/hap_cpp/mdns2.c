#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h> /* Unix System Calls */
#include <sys/socket.h> /* socket specific definitions */
#include <arpa/inet.h>  /* IP address conversion stuff */

const uint8_t buf[] = { 0x0, 0x0, 0x84, 0x0, 0x0, 0x0, 0x0, 0x2, 0x0, 0x0, 0x0, 0x0, 0x4, 0x5f, 0x68, 0x61, 
                        0x70, 0x4, 0x5f, 0x74, 0x63, 0x70, 0x5, 0x6c, 0x6f, 0x63, 0x61, 0x6c, 0x0, 0x0, 0xc, 
                        0x0, 0x1, 0x0, 0x0, 0x0, 0x1e, 0x0, 0x1d, 0xb, 0x54, 0x65, 0x73, 0x74, 0x20, 0x42, 
                        0x72, 0x69, 0x64, 0x67, 0x65, 0x4, 0x5f, 0x68, 0x61, 0x70, 0x4, 0x5f, 0x74, 0x63, 
                        0x70, 0x5, 0x6c, 0x6f, 0x63, 0x61, 0x6c, 0x0, 0xb, 0x54, 0x65, 0x73, 0x74, 0x20, 0x42, 
                        0x72, 0x69, 0x64, 0x67, 0x65, 0x4, 0x5f, 0x68, 0x61, 0x70, 0x4, 0x5f, 0x74, 0x63, 0x70, 
                        0x5, 0x6c, 0x6f, 0x63, 0x61, 0x6c, 0x0, 0x0, 0x10, 0x80, 0x1, 0x0, 0x0, 0x0, 0x1e, 0x0, 
                        0x3e, 0xe, 0x6d, 0x64, 0x3d, 0x54, 0x65, 0x73, 0x74, 0x20, 0x42, 0x72, 0x69, 0x64, 0x67, 
                        0x65, 0x4, 0x63, 0x23, 0x3d, 0x31, 0x4, 0x73, 0x23, 0x3d, 0x31, 0x4, 0x66, 0x66, 0x3d, 
                        0x30, 0x4, 0x63, 0x69, 0x3d, 0x31, 0x14, 0x69, 0x64, 0x3d, 0x31, 0x31, 0x3a, 0x31, 0x31, 
                        0x3a, 0x31, 0x31, 0x3a, 0x31, 0x31, 0x3a, 0x31, 0x31, 0x3a, 0x31, 0x31, 0x4, 0x73, 0x66, 
                        0x3d, 0x31, 0x0 };


#define MDNS_PORT 5353
#define MDNS_GROUP "224.0.0.251"
                        
static void send_to(const uint8_t* packet, uint16_t len) 
{
    static int fd;
    static struct sockaddr_in addr;
    if (fd == 0) 
    {
        if( (fd = socket(AF_INET, SOCK_DGRAM, 0)) < 0)
        {
            perror("Problem creating socket\n");
            exit(1);
        }

        memset(&addr,0,sizeof(addr));
        addr.sin_family = AF_INET;
        addr.sin_addr.s_addr = inet_addr(MDNS_GROUP);
        addr.sin_port = htons(MDNS_PORT);
    }

    sendto(fd, packet, len, 0, (struct sockaddr *) &addr, sizeof(addr));
}

int main(void)
{              
    while (1)
    {
        send_to (buf, sizeof(buf));
        sleep(1);
    }

}
